---
- include_tasks: debian_source.yml
  when: ansible_os_family == "Debian"

- name: install | Checking If Digital Rebar Is Already Installed
  stat:
    path: "{{ digital_rebar_binary }}"
  register: _digital_rebar_install_check

- name: install | Downloading Digital Rebar Source
  get_url:
    url: "{{ digital_rebar_source_dl }}"
    dest: "/tmp/{{ digital_rebar_package }}"
    checksum: "sha256:{{ digital_rebar_source_sha256 }}"
  when: not _digital_rebar_install_check['stat']['exists']

- name: install | Extracting Digital Rebar Source
  unarchive:
    src: "/tmp/{{ digital_rebar_package }}"
    dest: /tmp
    remote_src: true
  register: _digital_rebar_extracted
  when: not _digital_rebar_install_check['stat']['exists']

# - name: build | Build Digital Rebar Packages

# - name: install | Copying Digital Rebar Packages
#   copy:
#     src: "/tmp/bin/linux/amd64/{{ item }}"
#     dest: "{{ digital_rebar_install_dir }}/{{ item }}"
#     mode: "u=rwx,g=rx,o=rx"
#     remote_src: true
#   become: true
#   with_items:
#     - drpcli
#     - dr-provision
#     - incrementer
#   when: >
#         not _digital_rebar_install_check['stat']['exists'] and
#         _digital_rebar_extracted['changed']
#
# - name: install | Creating /var/lib/dr-provision
#   file:
#     path: /var/lib/dr-provision
#     state: directory
#   become: true
